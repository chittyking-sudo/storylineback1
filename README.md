# å¤šAgentåä½œæ¸¸æˆå†…å®¹ç”Ÿæˆå™¨

åŸºäº AI å¤šæ™ºèƒ½ä½“åä½œçš„æ¸¸æˆå†…å®¹è‡ªåŠ¨ç”Ÿæˆç³»ç»Ÿï¼Œå¯è‡ªåŠ¨ç”Ÿæˆæ¸¸æˆä¸–ç•Œè§‚ã€å‰§æƒ…ã€è§’è‰²å’Œå¯¹è¯ã€‚

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

- **åç§°**: Multi-Agent Game Generator
- **ç›®æ ‡**: åˆ©ç”¨å¤šä¸ª AI Agent åä½œï¼Œè‡ªåŠ¨åŒ–ç”Ÿæˆå®Œæ•´çš„æ¸¸æˆå†…å®¹æ¡†æ¶
- **æŠ€æœ¯æ ˆ**: Hono + TypeScript + Cloudflare Workers + Cloudflare D1

## ğŸŒ åœ¨çº¿è®¿é—®

- **ç”Ÿäº§ç¯å¢ƒ**: https://3000-imt0hr8ioseb4qc1ytnn4-2b54fc91.sandbox.novita.ai
- **API å¥åº·æ£€æŸ¥**: https://3000-imt0hr8ioseb4qc1ytnn4-2b54fc91.sandbox.novita.ai/api/health
- **GitHub ä»“åº“**: https://github.com/chittyking-sudo/storylineback1

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### ğŸ‰ v2.0 æ–°å¢åŠŸèƒ½

1. **å¤šç§ç”Ÿæˆæ¨¡å¼**
   - ä»…ç”Ÿæˆä¸–ç•Œè§‚
   - ä¸–ç•Œè§‚ + è§’è‰²
   - å®Œæ•´ç”Ÿæˆï¼ˆä¸–ç•Œè§‚+å‰§æƒ…+è§’è‰²+å¯¹è¯ï¼‰

2. **å¤šæ¨¡å‹æ”¯æŒ**
   - OpenAI GPT-4o-miniï¼ˆé»˜è®¤ï¼Œæ€§ä»·æ¯”é«˜ï¼‰
   - Google Geminiï¼ˆå…è´¹ï¼Œåˆ›æ„æ€§å¼ºï¼‰
   - OpenAI GPT-4oï¼ˆè´¨é‡æœ€é«˜ï¼‰
   - æ”¯æŒå¤šæ¨¡å‹åŒæ—¶ç”Ÿæˆå’Œå¯¹æ¯”

3. **åˆ†é˜¶æ®µç”Ÿæˆ**
   - ä¸–ç•Œè§‚è¯¦æƒ…é¡µå¯ç»§ç»­ç”Ÿæˆè§’è‰²
   - ä¸–ç•Œè§‚è¯¦æƒ…é¡µå¯ç”Ÿæˆå¯¹è¯
   - è§’è‰²è¯¦æƒ…é¡µå¯ç”Ÿæˆå¯¹è¯
   - çµæ´»çš„å†…å®¹æ‰©å±•

4. **æ¨¡å‹æµ‹è¯•åŠŸèƒ½**
   - å¤šæ¨¡å‹å¯¹æ¯”æµ‹è¯•
   - å®æ—¶æŸ¥çœ‹ä¸åŒæ¨¡å‹è¾“å‡º
   - Token æ¶ˆè€—ç»Ÿè®¡
   - å¸®åŠ©é€‰æ‹©æœ€ä½³æ¨¡å‹

### å·²å®ŒæˆåŠŸèƒ½

1. **ä¸–ç•Œè§‚ç”Ÿæˆ** (å¤šæ¨¡å‹æ”¯æŒ)
   - å†å²èƒŒæ™¯æ„å»º
   - åœ°ç†ç¯å¢ƒè®¾å®š
   - æ–‡åŒ–ä½“ç³»åˆ›å»º
   - ä¼ è¯´æ•…äº‹ç¼–å†™
   - æ”¯æŒå¤šæ¨¡å‹å¯¹æ¯”

2. **å‰§æƒ…æ¶æ„ç”Ÿæˆ** (GPT-4)
   - ä¸»çº¿å‰§æƒ…è®¾è®¡
   - ä¸‰å¹•ç»“æ„è§„åˆ’
   - å†²çªç‚¹è®¾ç½®
   - è§’è‰²æˆé•¿å¼§çº¿

3. **è§’è‰²åˆ›å»º** (å¤šæ¨¡å‹æ”¯æŒ)
   - è§’è‰²æ€§æ ¼å¡‘é€ 
   - èƒŒæ™¯æ•…äº‹ç¼–å†™
   - å¤–è²Œæè¿°
   - å…³ç³»ç½‘ç»œæ„å»º
   - æ”¯æŒå¤šæ¨¡å‹å¯¹æ¯”

4. **å¯¹è¯ç”Ÿæˆ** (GPT-4)
   - ç¬¦åˆè§’è‰²æ€§æ ¼çš„å¯¹è¯
   - æƒ…æ„ŸçŠ¶æ€æ ‡æ³¨
   - åœºæ™¯åŒ–å¯¹è¯è„šæœ¬
   - æ”¯æŒç‰¹å®šåœºæ™¯å®šåˆ¶

5. **å†…å®¹å¯¼å‡º**
   - JSON æ ¼å¼å¯¼å‡º
   - Markdown æ ¼å¼å¯¼å‡º
   - å®Œæ•´é¡¹ç›®æ•°æ®å¤‡ä»½

### å¾…å®ç°åŠŸèƒ½

- ä¸€è‡´æ€§æ£€æŸ¥ Agent (è‡ªåŠ¨æ£€æµ‹é€»è¾‘å†²çª)
- è´¨é‡è¯„ä¼° Agent (è¯„åˆ†å’Œä¼˜åŒ–å»ºè®®)
- æ”¯çº¿å‰§æƒ…ç”Ÿæˆ
- æ›´å¤šè§’è‰²å¯¹è¯åœºæ™¯
- æ¸¸æˆæœºåˆ¶å»ºè®®

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### Agent åä½œæµç¨‹

```
ç”¨æˆ·è¾“å…¥
   â†“
Master Orchestrator
   â†“
1. ä¸–ç•Œè§‚è®¾è®¡ Agent (GPT-4o-mini)
   â†“
2. å‰§æƒ…æ¶æ„ Agent (GPT-4o-mini)
   â†“
3. è§’è‰²åˆ›å»º Agent (Claude-3-Sonnet) [å¹¶è¡Œ]
   â†“
4. å¯¹è¯ç”Ÿæˆ Agent (GPT-4o-mini)
   â†“
ç»“æœæ•´åˆ & ä¿å­˜
```

### æŠ€æœ¯æ ˆè¯¦æƒ…

- **åç«¯æ¡†æ¶**: Hono (è½»é‡çº§ Web æ¡†æ¶)
- **è¿è¡Œæ—¶**: Cloudflare Workers
- **æ•°æ®åº“**: Cloudflare D1 (SQLite)
- **AI æ¨¡å‹**:
  - OpenAI GPT-4o-mini (ä¸–ç•Œè§‚ã€å‰§æƒ…ã€è§’è‰²ã€å¯¹è¯)
  - Google Gemini (å¤‡ç”¨)
- **å‰ç«¯**: HTML + TailwindCSS + Vanilla JS

## ğŸ“Š æ•°æ®æ¨¡å‹

### æ•°æ®åº“è¡¨ç»“æ„

1. **projects** - é¡¹ç›®ä¿¡æ¯
2. **worldviews** - ä¸–ç•Œè§‚å†…å®¹
3. **storylines** - å‰§æƒ…æ¶æ„
4. **characters** - è§’è‰²æ•°æ®
5. **dialogues** - å¯¹è¯è„šæœ¬
6. **generation_logs** - ç”Ÿæˆæ—¥å¿—

è¯¦ç»† Schema è¯·æŸ¥çœ‹ `migrations/0001_initial_schema.sql`

## ğŸš€ API æ¥å£

### æ ¸å¿ƒ API ç«¯ç‚¹

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | å‚æ•° |
|------|------|------|------|
| POST | `/api/generate` | åˆ›å»ºæ–°é¡¹ç›®å¹¶ç”Ÿæˆå†…å®¹ | projectName, gameType, theme, characterCount, generateDialogues |
| GET | `/api/projects` | è·å–æ‰€æœ‰é¡¹ç›®åˆ—è¡¨ | - |
| GET | `/api/projects/:id` | è·å–é¡¹ç›®è¯¦æƒ… | id |
| GET | `/api/projects/:id/export` | å¯¼å‡ºé¡¹ç›® | id, format (json/markdown) |
| GET | `/api/health` | å¥åº·æ£€æŸ¥ | - |

### ç¤ºä¾‹è¯·æ±‚

#### åˆ›å»ºæ–°é¡¹ç›®

```bash
curl -X POST https://your-domain.com/api/generate \
  -H "Content-Type: application/json" \
  -d '{
    "projectName": "é­”æ³•å¤§é™†å†’é™©",
    "gameType": "RPG",
    "theme": "ä¸€ä¸ªè¢«é­”æ³•å’Œç§‘æŠ€å…±å­˜çš„ä¸–ç•Œï¼Œä¸»è§’éœ€è¦å¯»æ‰¾å¤±è½çš„å¤ä»£æ–‡æ˜é—è¿¹",
    "characterCount": 5,
    "generateDialogues": true
  }'
```

#### è·å–é¡¹ç›®åˆ—è¡¨

```bash
curl https://your-domain.com/api/projects
```

#### å¯¼å‡ºé¡¹ç›®

```bash
# JSON æ ¼å¼
curl https://your-domain.com/api/projects/1/export?format=json

# Markdown æ ¼å¼
curl https://your-domain.com/api/projects/1/export?format=markdown
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### æœ¬åœ°å¼€å‘

1. **å®‰è£…ä¾èµ–**
```bash
npm install
```

2. **åº”ç”¨æ•°æ®åº“è¿ç§»**
```bash
npm run db:migrate:local
```

3. **æ„å»ºé¡¹ç›®**
```bash
npm run build
```

4. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**
```bash
npm run dev:d1
# æˆ–ä½¿ç”¨ PM2
pm2 start ecosystem.config.cjs
```

5. **è®¿é—®åº”ç”¨**
```
http://localhost:3000
```

### ç”Ÿäº§éƒ¨ç½²

**éƒ¨ç½²åˆ° Cloudflare Pages**:

1. **é…ç½® API å¯†é’¥**
```bash
# è®¾ç½®ä¸º Cloudflare Secrets
wrangler pages secret put OPENAI_API_KEY
wrangler pages secret put ANTHROPIC_API_KEY
wrangler pages secret put GOOGLE_API_KEY
```

2. **åˆ›å»º D1 æ•°æ®åº“**
```bash
wrangler d1 create game-generator-db
# å°†è¿”å›çš„ database_id æ›´æ–°åˆ° wrangler.jsonc
```

3. **åº”ç”¨ç”Ÿäº§æ•°æ®åº“è¿ç§»**
```bash
npm run db:migrate:prod
```

4. **éƒ¨ç½²åº”ç”¨**
```bash
npm run deploy:prod
```

## ğŸ® ä½¿ç”¨ç¤ºä¾‹

### åˆ›å»ºä¸€ä¸ª RPG æ¸¸æˆé¡¹ç›®

1. è®¿é—®ä¸»é¡µ
2. å¡«å†™é¡¹ç›®ä¿¡æ¯:
   - é¡¹ç›®åç§°: "æ˜Ÿé™…æ¢é™©"
   - æ¸¸æˆç±»å‹: RPG
   - ä¸»é¢˜: "2080å¹´ï¼Œäººç±»æ®–æ°‘ç«æ˜Ÿï¼Œä¸»è§’æ˜¯ä¸€åå¤ªç©ºæ¢é™©å®¶ï¼Œéœ€è¦è°ƒæŸ¥ç¥ç§˜ä¿¡å·"
   - è§’è‰²æ•°é‡: 5
3. ç‚¹å‡»"å¼€å§‹ç”Ÿæˆ"
4. ç­‰å¾… 1-2 åˆ†é’Ÿï¼ŒAI Agents åä½œå®Œæˆ
5. æŸ¥çœ‹ç”Ÿæˆçš„ä¸–ç•Œè§‚ã€å‰§æƒ…ã€è§’è‰²å’Œå¯¹è¯
6. å¯¼å‡ºä¸º JSON æˆ– Markdown

### ç”Ÿæˆå†…å®¹ç¤ºä¾‹

**ä¸–ç•Œè§‚**:
- æ ‡é¢˜: æ˜Ÿé™…è”é‚¦ 2080
- å†å²: 2050å¹´äººç±»é¦–æ¬¡ç™»é™†ç«æ˜Ÿ...
- åœ°ç†: ç«æ˜Ÿè¡¨é¢åˆ†ä¸º7ä¸ªæ®–æ°‘åŒº...
- æ–‡åŒ–: åœ°çƒä¸ç«æ˜Ÿæ–‡åŒ–èåˆ...
- ä¼ è¯´: å¤ä»£ç«æ˜Ÿæ–‡æ˜çš„ä¼ è¯´...

**è§’è‰²**:
- ä¸»è§’: ææ˜ (å¤ªç©ºæ¢é™©å®¶)
- é…è§’: è‰¾è‰æ£®åšå£« (ç§‘å­¦å®¶)
- NPC: å•†äººã€å†›å®˜ã€ç¥ç§˜äººç­‰

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

- **å•æ¬¡ç”Ÿæˆæ—¶é—´**: 60-120ç§’
- **Token æ¶ˆè€—**: çº¦ 5000-10000 tokens/é¡¹ç›®
- **å¹¶å‘æ”¯æŒ**: åŸºäº Cloudflare Workers çš„é«˜å¹¶å‘èƒ½åŠ›
- **æ•°æ®åº“**: Cloudflare D1 å…¨çƒåˆ†å¸ƒ

## ğŸ” å®‰å…¨è¯´æ˜

- API å¯†é’¥å­˜å‚¨åœ¨ `.dev.vars` (æœ¬åœ°) å’Œ Cloudflare Secrets (ç”Ÿäº§)
- `.dev.vars` æ–‡ä»¶å·²åŠ å…¥ `.gitignore`ï¼Œä¸ä¼šæäº¤åˆ° Git
- æ‰€æœ‰ API è°ƒç”¨åœ¨åç«¯æ‰§è¡Œï¼Œå‰ç«¯ä¸æš´éœ²å¯†é’¥

## ğŸ› ï¸ å¼€å‘å·¥å…·

### NPM è„šæœ¬

```bash
# å¼€å‘
npm run dev              # Vite å¼€å‘æœåŠ¡å™¨
npm run dev:sandbox      # Wrangler æœ¬åœ°å¼€å‘
npm run dev:d1           # å¸¦ D1 æ•°æ®åº“çš„å¼€å‘

# æ„å»ºå’Œéƒ¨ç½²
npm run build            # æ„å»ºé¡¹ç›®
npm run deploy           # éƒ¨ç½²åˆ° Cloudflare
npm run deploy:prod      # ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

# æ•°æ®åº“
npm run db:migrate:local # æœ¬åœ°æ•°æ®åº“è¿ç§»
npm run db:migrate:prod  # ç”Ÿäº§æ•°æ®åº“è¿ç§»
npm run db:reset         # é‡ç½®æœ¬åœ°æ•°æ®åº“
npm run db:console:local # æœ¬åœ°æ•°æ®åº“æ§åˆ¶å°

# å·¥å…·
npm run clean-port       # æ¸…ç† 3000 ç«¯å£
npm run test             # æµ‹è¯•æœåŠ¡
```

## ğŸ› æ•…éšœæ’é™¤

### ç«¯å£å ç”¨
```bash
npm run clean-port
# æˆ–
fuser -k 3000/tcp
```

### æ•°æ®åº“é‡ç½®
```bash
npm run db:reset
```

### æŸ¥çœ‹æ—¥å¿—
```bash
pm2 logs game-generator --nostream
```

### é‡å¯æœåŠ¡
```bash
pm2 restart game-generator
```

## ğŸ“ æ¨èä¸‹ä¸€æ­¥

1. **å¢å¼ºåŠŸèƒ½**
   - æ·»åŠ ä¸€è‡´æ€§æ£€æŸ¥ Agent
   - å®ç°è´¨é‡è¯„ä¼°ç³»ç»Ÿ
   - æ”¯æŒæ›´å¤šæ¸¸æˆç±»å‹

2. **æ€§èƒ½ä¼˜åŒ–**
   - å®ç°ç»“æœç¼“å­˜
   - ä¼˜åŒ– Token ä½¿ç”¨
   - æ·»åŠ è¿›åº¦åé¦ˆ

3. **ç”¨æˆ·ä½“éªŒ**
   - æ·»åŠ å®æ—¶ç”Ÿæˆè¿›åº¦
   - æ”¯æŒé¡¹ç›®ç¼–è¾‘
   - å¢åŠ æ›´å¤šå¯¼å‡ºæ ¼å¼

4. **éƒ¨ç½²**
   - é…ç½®è‡ªå®šä¹‰åŸŸå
   - è®¾ç½® CI/CD æµç¨‹
   - æ·»åŠ ç›‘æ§å’Œæ—¥å¿—

## ğŸ“„ è®¸å¯è¯

ISC License

## ğŸ‘¥ è´¡çŒ®è€…

- AI Assistant - åˆå§‹å¼€å‘

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·åˆ›å»º Issue æˆ– Pull Requestã€‚

---

**æœ€åæ›´æ–°**: 2024-11-21
**é¡¹ç›®çŠ¶æ€**: âœ… è¿è¡Œä¸­
**ç‰ˆæœ¬**: 2.0.0

## ğŸ†• v2.0 æ›´æ–°å†…å®¹

æŸ¥çœ‹å®Œæ•´åŠŸèƒ½è¯´æ˜: [FEATURES.md](FEATURES.md)

**ä¸»è¦æ›´æ–°**:
- âœ… 3ç§ç”Ÿæˆæ¨¡å¼ï¼ˆä¸–ç•Œè§‚ã€ä¸–ç•Œè§‚+è§’è‰²ã€å®Œæ•´ï¼‰
- âœ… å¤šæ¨¡å‹æ”¯æŒï¼ˆOpenAI GPT-4o-mini/4o, Google Geminiï¼‰
- âœ… åˆ†é˜¶æ®µç”Ÿæˆï¼ˆå¯åœ¨ä»»æ„é˜¶æ®µæ·»åŠ å†…å®¹ï¼‰
- âœ… æ¨¡å‹æµ‹è¯•åŠŸèƒ½ï¼ˆå¯¹æ¯”ä¸åŒæ¨¡å‹è¾“å‡ºï¼‰
- âœ… ä¼˜åŒ–çš„ç”¨æˆ·ç•Œé¢
