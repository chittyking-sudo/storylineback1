# 新功能说明文档

## 🎉 版本 v2.0 - 高级功能更新

### 📅 更新日期: 2024-11-21

---

## ✨ 新增功能概览

### 1. 多种生成模式

现在支持灵活的内容生成策略，用户可以根据需求选择不同的生成模式：

#### 🌍 仅生成世界观
- **适用场景**: 快速构建游戏世界背景
- **生成内容**: 历史、地理、文化、传说
- **后续操作**: 可在世界观基础上继续生成角色和对话

#### 👥 世界观 + 角色
- **适用场景**: 一次性获得完整的世界设定和角色群像
- **生成内容**: 世界观 + 指定数量的角色
- **优势**: 角色与世界观更加契合

#### 📖 完整生成
- **适用场景**: 一键生成完整游戏内容
- **生成内容**: 世界观 + 剧情 + 角色 + 示例对话
- **适用于**: 快速原型开发

---

## 🤖 多模型支持

### 可选择的 AI 模型

| 模型 | 特点 | 成本 | 速度 | 推荐场景 |
|------|------|------|------|---------|
| **OpenAI GPT-4o-mini** | 性价比高、质量稳定 | 低 | 快 | 日常使用（默认） |
| **Google Gemini** | 多语言支持、创意性强 | 低 | 快 | 多样化生成 |
| **OpenAI GPT-4o** | 质量最高、理解能力强 | 高 | 中 | 关键内容生成 |

### 多模型对比生成

- **功能**: 同时使用多个模型生成相同内容
- **用途**: 
  - 对比不同模型的输出质量
  - 获得更多创意选择
  - 评估模型性能
- **实现**: 勾选多个模型，系统将并行生成并展示所有结果

**示例**: 
```
选择: OpenAI GPT-4o-mini + Google Gemini + GPT-4o
结果: 生成 3 个不同版本的世界观，用户可选择最满意的
```

---

## 🔧 分阶段生成功能

### 世界观页面操作

在查看世界观详情时，提供以下操作：

#### 1. 生成角色
- **入口**: 世界观卡片右上角"生成角色"按钮
- **流程**: 
  1. 点击按钮
  2. 输入角色数量（3-10个）
  3. 等待生成（15-30秒）
  4. 自动刷新页面显示新角色
- **优势**: 基于已有世界观生成更契合的角色

#### 2. 生成对话
- **入口**: 世界观卡片右上角"生成对话"按钮
- **前提**: 必须已有角色
- **流程**:
  1. 点击按钮
  2. 输入场景名称（如"开场场景"）
  3. 输入场景情境（如"角色初次见面"）
  4. 等待生成（5-15秒）
  5. 自动刷新显示对话内容
- **适用**: 为现有角色创建特定场景的对话

### 角色页面操作

在查看角色列表时，提供以下操作：

#### 1. 生成对话
- **入口**: 角色卡片右上角"生成对话"按钮
- **功能**: 为所有角色生成对话
- **流程**: 同世界观页面的生成对话

#### 2. 模型测试
- **入口**: 角色卡片右上角"模型测试"按钮
- **功能**: 多模型对比测试
- **流程**:
  1. 点击按钮
  2. 输入测试对话内容（如"你好，最近怎么样？"）
  3. 系统使用 3 个不同模型同时生成回复
  4. 在模态框中对比展示所有结果
- **对比指标**:
  - 回复内容
  - Token 消耗
  - 角色性格符合度

---

## 🎮 使用场景示例

### 场景 1: 快速世界观迭代

```
1. 选择"仅生成世界观"模式
2. 选择多个模型（OpenAI + Gemini + GPT-4o）
3. 生成后对比 3 个版本
4. 选择最满意的世界观
5. 基于该世界观继续生成角色和对话
```

**优势**: 
- 快速获得多个版本
- 灵活选择最佳方案
- 节省时间和成本

### 场景 2: 角色对话测试

```
1. 完整生成一个项目（包含角色）
2. 打开项目详情，查看角色
3. 点击"模型测试"按钮
4. 输入测试问题："如何看待战争？"
5. 对比 3 个模型的回答
6. 评估哪个模型最符合角色性格
```

**优势**:
- 评估模型质量
- 优化角色对话
- 选择最佳模型

### 场景 3: 渐进式内容构建

```
1. 先生成世界观
2. 审阅世界观内容
3. 基于世界观生成 5 个角色
4. 为特定场景生成对话
5. 继续添加更多角色或对话
```

**优势**:
- 分步骤控制
- 逐步完善内容
- 灵活调整方向

---

## 🔍 API 端点说明

### 新增 API 端点

#### 1. 仅生成世界观
```
POST /api/generate/worldview

Body:
{
  "projectName": "项目名称",
  "gameType": "RPG",
  "theme": "主题描述",
  "models": ["openai", "google"]  // 可选多个
}

Response:
{
  "success": true,
  "projectId": 1,
  "worldviews": [
    { id: 1, title: "...", history: "...", ... },
    { id: 2, title: "...", history: "...", ... }
  ],
  "totalDuration": 15000,
  "totalTokens": 3000
}
```

#### 2. 为世界观生成角色
```
POST /api/generate/characters

Body:
{
  "projectId": 1,
  "worldviewId": 1,
  "characterCount": 5,
  "models": ["openai"]
}

Response:
{
  "success": true,
  "characters": [ ... ],
  "totalDuration": 20000,
  "totalTokens": 4000
}
```

#### 3. 生成对话
```
POST /api/generate/dialogue

Body:
{
  "projectId": 1,
  "characterIds": [1, 2, 3],
  "sceneName": "开场场景",
  "sceneContext": "角色初次见面"
}

Response:
{
  "success": true,
  "dialogues": [ ... ],
  "totalDuration": 10000,
  "totalTokens": 2000
}
```

#### 4. 模型测试
```
POST /api/test/models

Body:
{
  "prompt": "你好，最近怎么样？",
  "systemPrompt": "你是游戏角色...",
  "models": ["openai", "google", "openai:gpt-4o"]
}

Response:
{
  "success": true,
  "results": [
    {
      "model": "openai",
      "success": true,
      "content": "回复内容...",
      "tokens": 50
    },
    ...
  ],
  "totalDuration": 8000
}
```

---

## 💡 最佳实践

### 1. 模型选择建议

**日常使用**:
- ✅ 仅选择 OpenAI GPT-4o-mini（速度快、成本低）

**质量对比**:
- ✅ 选择 OpenAI + Gemini（获得不同风格）

**关键内容**:
- ✅ 选择 OpenAI GPT-4o（质量最高）

**成本控制**:
- ✅ 避免同时使用多个高成本模型
- ✅ 优先使用 mini 版本测试，满意后再用完整版

### 2. 生成模式选择

**项目初期**:
- ✅ 使用"仅生成世界观"模式
- ✅ 多模型对比，选择最佳版本
- ✅ 基于世界观逐步添加内容

**快速原型**:
- ✅ 使用"完整生成"模式
- ✅ 一次性获得所有内容
- ✅ 后续根据需要调整

**精细打磨**:
- ✅ 分阶段生成各部分
- ✅ 每个阶段都用模型测试
- ✅ 选择最优内容组合

### 3. 对话生成技巧

**场景设定**:
- ✅ 场景名称要具体（如"酒馆夜晚"而非"场景1"）
- ✅ 情境描述要详细（包含情绪、环境、目标）

**模型测试**:
- ✅ 准备多个测试问题
- ✅ 覆盖不同情境（日常、战斗、情感）
- ✅ 记录最适合各场景的模型

---

## 📊 性能对比

### 生成速度（单个内容）

| 内容类型 | 单模型 | 3个模型并行 |
|---------|--------|------------|
| 世界观 | 10-15秒 | 15-20秒 |
| 角色(5个) | 15-20秒 | 25-35秒 |
| 对话 | 5-10秒 | 10-15秒 |

### Token 消耗（单个内容）

| 内容类型 | GPT-4o-mini | Gemini | GPT-4o |
|---------|------------|--------|--------|
| 世界观 | 1500-2000 | 1200-1800 | 2000-2500 |
| 角色(5个) | 2000-3000 | 1800-2500 | 3000-4000 |
| 对话 | 500-800 | 400-600 | 800-1200 |

### 成本估算

| 模型 | 价格/1M tokens | 世界观成本 | 角色(5个)成本 |
|------|---------------|-----------|--------------|
| GPT-4o-mini | $0.15 | $0.0003 | $0.0004 |
| Gemini | 免费额度 | $0 | $0 |
| GPT-4o | $5.00 | $0.010 | $0.015 |

---

## 🎯 更新总结

### 主要改进

1. ✅ **灵活生成**: 支持 3 种生成模式
2. ✅ **多模型选择**: 可选择和对比多个 AI 模型
3. ✅ **分阶段操作**: 可在任意阶段添加内容
4. ✅ **模型测试**: 对比不同模型的输出质量
5. ✅ **交互优化**: 更直观的操作界面

### 用户价值

- 🎨 **更多创意选择**: 多模型对比获得更多版本
- ⚡ **更快迭代速度**: 分阶段生成更灵活
- 💰 **更好成本控制**: 可根据需求选择模型
- 🎯 **更高内容质量**: 模型测试确保最佳输出

---

## 📝 反馈与建议

如有问题或建议，请在 GitHub 提交 Issue：
https://github.com/chittyking-sudo/storylineback1/issues

---

**版本**: v2.0  
**更新日期**: 2024-11-21  
**文档作者**: AI Assistant
